# 中国股指期货+股指期权量化项目
## 从零到一完整路线图与详细报告

**报告版本**: v1.0
**编制日期**: 2025-01-05
**适用市场**: 中国金融期货交易所(中金所/CFFEX)

---

# 基础核对：合约要素与制度约束

## 一、中金所股指期货合约要素

| 品种 | 代码 | 标的指数 | 合约乘数 | 最小变动价位 | 交易所保证金 | 涨跌停 |
|------|------|----------|----------|--------------|--------------|--------|
| 沪深300股指期货 | IF | 沪深300 | 300元/点 | 0.2点(60元) | 12% | ±10% |
| 上证50股指期货 | IH | 上证50 | 300元/点 | 0.2点(60元) | 12% | ±10% |
| 中证500股指期货 | IC | 中证500 | 200元/点 | 0.2点(40元) | 14% | ±10% |
| 中证1000股指期货 | IM | 中证1000 | 200元/点 | 0.2点(40元) | 15% | ±10% |

**合约月份**: 当月、下月及随后两个季月
**交易时间**: 9:30-11:30, 13:00-15:00
**最后交易日**: 合约到期月份第三个周五
**交割方式**: 现金交割
**交割结算价**: 最后交易日标的指数最后2小时算术平均价

**来源**: [中国金融期货交易所官网](http://www.cffex.com.cn/) | 口径: 交易所公告 | 截止日期: 2025-01

## 二、中金所股指期权合约要素

| 品种 | 代码 | 标的指数 | 合约乘数 | 行权方式 | 交易所保证金 |
|------|------|----------|----------|----------|--------------|
| 沪深300股指期权 | IO | 沪深300 | 100元/点 | 欧式 | 卖方需缴纳 |
| 上证50股指期权 | HO | 上证50 | 100元/点 | 欧式 | 卖方需缴纳 |
| 中证1000股指期权 | MO | 中证1000 | 100元/点 | 欧式 | 卖方需缴纳 |

**最小变动价位**: 0.2点(20元)
**合约月份**: 当月、下两个月及随后三个季月
**行权价格间距**: 根据标的指数点位设置(通常25点或50点)
**涨跌停**: 上一交易日标的指数收盘价的±10%
**自动行权**: 实值额>行权手续费时自动行权

**来源**: [中金所股指期权规则](http://www.cffex.com.cn/jysgz/) | 口径: 交易所公告 | 截止日期: 2025-01

## 三、关键制度约束

### 3.1 持仓限额

| 类别 | 股指期货 | 股指期权 |
|------|----------|----------|
| 投机户单合约限额 | IF/IH: 5000手, IC/IM: 1200手 | 单月份单边1200手 |
| 日内开仓限制 | 单合约500手(投机) | 同期货 |
| 套保户 | 需单独申请额度 | 需单独申请额度 |
| 做市商 | 特殊限额 | 15000手(全月份) |

**来源**: [中金所套期保值管理办法](http://www.cffex.com.cn/tqbzytledbl/) | 截止日期: 2025-01

### 3.2 手续费结构

| 品种 | 开仓手续费 | 平今仓手续费 | 行权手续费 |
|------|------------|--------------|------------|
| IF/IH | 成交额×0.23‱ | 成交额×3.45‱ | - |
| IC/IM | 成交额×0.23‱ | 成交额×3.45‱ | - |
| IO/HO/MO | 15元/手 | 15元/手 | 2元/手 |

**关键点**: 平今仓手续费是开仓的15倍，日内交易成本极高！

**来源**: [中金所手续费通知](http://www.cffex.com.cn/jystz/) | 截止日期: 2025-01

### 3.3 开户门槛

- 验资: 连续5个交易日可用资金≥50万
- 知识测试: ≥80分
- 交易经历: 10笔期货/期权实盘或20笔仿真

## 四、待验证清单

| 项目 | 状态 | 说明 |
|------|------|------|
| 最新保证金调整公告 | 待验证 | 需查中金所最新通知 |
| 期权保证金具体计算公式 | 待验证 | 涉及Delta调整 |
| 做市商具体报价义务 | 待验证 | 需查做市商协议 |
| 大户报告制度阈值 | 待验证 | 需查最新规定 |

---

# 第0章 一页纸结论（交易员版）

## 项目定位

**做什么**:
1. 以中金所股指期货(IF/IC/IM)和股指期权(IO/MO)为核心交易品种
2. 构建"波动率风险溢价收割 + 方向性择时增强 + 尾部风险对冲"三位一体策略体系
3. 优先发展"风险定义结构"(价差/保护)，严控裸卖风险

**不做什么**:
1. 不做高频做市(资质门槛+技术门槛过高)
2. 不做裸卖深度虚值(尾部风险不可控)
3. 不做跨市场套利(监管+资金效率问题)
4. 不追求日内高频(平今仓成本过高)

## 三个最优先的可盈利方向

| 排序 | 方向 | 核心逻辑 | 预期年化 | 风险等级 |
|------|------|----------|----------|----------|
| 1 | **卖出宽跨式+尾部保护** | 波动率风险溢价(VRP)长期为正，IV>RV | 15-25% | 中高 |
| 2 | **期限结构套利** | 近月vs远月IV差异均值回归 | 10-18% | 中 |
| 3 | **趋势信号+期权替代** | 用期权替代期货做方向，风险定义 | 20-40% | 中 |

**理由**:
- VRP在全球市场普遍存在，中国A股波动率风险溢价尤其显著
- 期限结构套利样本充足、逻辑硬、执行难度适中
- 方向性策略结合期货已验证信号，期权放大收益同时定义风险

## 三个最致命的风险与对策

| 风险 | 历史案例 | 对策 |
|------|----------|------|
| **波动率跳升** | 2024.9月行情，IV从15%飙至80% | 必须买入深度虚值保护腿，限制最大亏损 |
| **流动性枯竭** | 极端行情下bid-ask价差扩大10倍 | 设置流动性阈值，价差>X点暂停交易 |
| **Gamma风险** | 临近到期Pin风险，Delta剧烈变化 | 到期前5天强制减仓或移仓 |

## 6个月里程碑（成功标准）

| 月份 | 里程碑 | 验收标准 |
|------|--------|----------|
| M1 | 数据+回测闭环 | 能完整回测2年期权数据 |
| M2 | 3个核心策略回测完成 | 样本外Calmar>1.0 |
| M3 | 风控体系+仿真系统上线 | 压力测试通过 |
| M4 | 小资金实盘启动 | 10%仓位运行稳定 |
| M5 | 策略组合+风控联动 | 无重大风控事件 |
| M6 | 扩容评估 | 策略容量评估完成 |

**Go条件**: M3结束时，仿真交易Calmar>0.8，最大回撤<15%
**No-Go条件**: 任一策略样本外表现与样本内偏离>50%

---

# 第1章 市场与制度环境评估

## 1.1 市场结构

### 参与者构成

| 类型 | 占比(估计) | 特点 |
|------|------------|------|
| 机构套保 | 40-50% | 稳定持仓，主要在近月 |
| 量化私募 | 20-30% | 主力波动率交易者 |
| 个人投机 | 15-20% | 散户，多做方向 |
| 做市商 | 5-10% | 提供流动性 |

### 流动性分布

**期货**:
- 主力合约: 当月、下月(占成交量80%+)
- 季月合约: 流动性较差

**期权**:
- 行权价: 平值±2档流动性最好
- 月份: 当月、下月为主
- 深度虚值: 流动性极差，bid-ask价差大

### 主力合约特征

```
IF主力(当月): 日均成交10-15万手，持仓20-30万手
IO主力(当月平值): 日均成交1-3万手，持仓5-10万手
深度虚值期权: 日成交可能<100手，报价断层
```

## 1.2 监管与规则

### 制度演变历史

| 时间 | 事件 | 影响 |
|------|------|------|
| 2015.9 | 股灾后限仓 | 日内开仓限10手，流动性枯竭 |
| 2017-2019 | 逐步放宽 | 日内开仓放宽至500手 |
| 2019.12 | 沪深300期权上市 | 期权市场开启 |
| 2022.7 | 中证1000期权上市 | 品种扩容 |
| 2023+ | 持续优化 | 做市商扩容，流动性改善 |

### 关键规则清单

1. **日内开仓限制**: 投机户单合约500手/日
2. **平今仓成本**: 开仓的15倍(约0.35%)
3. **持仓限额**: 投机户单合约1200-5000手
4. **大户报告**: 超阈值需报告
5. **套保申请**: 需提前申请额度

## 1.3 天然不适合的策略

| 策略类型 | 原因 | 结论 |
|----------|------|------|
| **日内高频期货** | 平今仓成本3.45‱(约0.35%)，无利可图 | ❌ 不做 |
| **裸卖深度虚值** | 尾部风险无限，2024.9案例 | ❌ 不做 |
| **跨交易所套利** | A股与其他市场联动弱，资金效率低 | ❌ 不做 |
| **高频做市** | 需做市商资质，技术门槛极高 | ❌ 不做(除非有资质) |
| **复杂路径依赖** | 期权流动性不足，执行困难 | ⚠️ 谨慎 |

---

# 第2章 数据工程与数据治理

## 2.1 数据清单

### 核心数据

| 数据类型 | 字段 | 频率 | 优先级 |
|----------|------|------|--------|
| 标的指数 | OHLCV | Tick/1min/日 | P0 |
| 期货行情 | OHLCV+OI | Tick/1min/日 | P0 |
| 期权行情 | OHLCV+OI+Greeks | Tick/1min/日 | P0 |
| 隐含波动率 | ATM IV, Skew, Term | 日 | P0 |
| 波动率曲面 | 全行权价IV | 日 | P1 |
| 利率 | Shibor/国债 | 日 | P1 |
| 股息率 | 指数预期股息 | 月 | P2 |

### Greeks数据

| Greek | 用途 | 计算方式 |
|-------|------|----------|
| Delta | 方向暴露 | BS公式或数值 |
| Gamma | Delta变化率 | BS公式或数值 |
| Theta | 时间损耗 | BS公式 |
| Vega | 波动率敏感度 | BS公式 |
| Vanna | Delta对Vol敏感度 | 二阶导 |
| Volga | Vega对Vol敏感度 | 二阶导 |

## 2.2 数据源方案

| 数据源 | 成本 | 优点 | 缺点 | 推荐度 |
|--------|------|------|------|--------|
| **Wind** | 2-5万/年 | 权威、全面、API完善 | 贵 | ⭐⭐⭐⭐⭐ |
| **聚宽/米筐** | 0.5-2万/年 | 便宜、够用 | 数据质量次于Wind | ⭐⭐⭐⭐ |
| **AKShare** | 免费 | 免费、基础数据可用 | 期权数据有限 | ⭐⭐⭐ |
| **天勤** | 免费 | 期货数据好 | 无期权 | ⭐⭐(仅期货) |
| **交易所直连** | 席位费 | 最快、最准 | 贵、需资质 | ⭐⭐⭐⭐(机构) |

### 推荐方案

**Phase 1 (低成本启动)**: AKShare + 聚宽免费版
**Phase 2 (正式研究)**: 聚宽/米筐付费版
**Phase 3 (实盘)**: Wind + 交易所直连

## 2.3 数据质量问题

| 问题 | 表现 | 处理方法 |
|------|------|----------|
| 缺失 | 某时段无数据 | 插值/剔除/标记 |
| 异动 | 价格跳变 | 阈值过滤 |
| 合约换月 | 价格断层 | 复权/连续合约 |
| 盘后修正 | 结算价与实时不符 | 以结算价为准 |
| Greeks计算 | 不同BS假设差异 | 统一假设并文档化 |

## 2.4 交付物清单

| 交付物 | 内容 | 验收标准 |
|--------|------|----------|
| 数据字典 | 全部字段定义、来源、更新频率 | 无歧义 |
| ETL流程 | 数据获取→清洗→存储→校验 | 可自动化运行 |
| 质量报告 | 每日数据完整性、异常检测 | 自动生成 |
| 快照机制 | 任意历史时点数据可回放 | 支持回测需求 |

---

# 第3章 研究框架

## 3.1 期权收益归因

### P&L分解公式

```
P&L = Delta × ΔS + 0.5 × Gamma × ΔS² + Theta × Δt + Vega × ΔIV + 残差
```

### 各Greeks贡献解读

| Greek | 正收益来源 | 负收益来源 |
|-------|------------|------------|
| Delta | 方向判断正确 | 方向判断错误 |
| Gamma | 大波动(买方) | 大波动(卖方) |
| Theta | 时间流逝(卖方) | 时间流逝(买方) |
| Vega | IV上升(买方)/下降(卖方) | IV下降(买方)/上升(卖方) |

## 3.2 研究方法论

### 回测要求

| 维度 | 要求 | 原因 |
|------|------|------|
| 样本内/外 | 至少70%/30%分割 | 防止过拟合 |
| 滚动回测 | 每月/季度重训 | 检验稳定性 |
| 参数敏感性 | ±20%参数变化测试 | 避免参数脆弱 |
| 成本敏感性 | 成本×1.5/2.0测试 | 应对实盘滑点 |
| 压力测试 | 2015股灾/2024.9等 | 尾部风险评估 |

### 交易成本假设

| 成本项 | 期货 | 期权 |
|--------|------|------|
| 手续费(开仓) | 0.23‱ | 15元/手 |
| 手续费(平今) | 3.45‱ | 15元/手 |
| 滑点(正常) | 0.2-0.4点 | 0.2-1点 |
| 滑点(极端) | 1-2点 | 5-20点 |
| 冲击成本 | 大单需考虑 | 流动性差时显著 |

## 3.3 评估指标体系

### 核心指标

| 指标 | 公式 | 目标值 |
|------|------|--------|
| 年化收益 | CAGR | >15% |
| 最大回撤 | MaxDD | <20% |
| Calmar | CAGR/MaxDD | >1.0 |
| 夏普比率 | (R-Rf)/σ | >1.5 |
| 胜率 | Win/Total | >40% |
| 盈亏比 | AvgWin/AvgLoss | >1.5 |

### 期权专用指标

| 指标 | 含义 | 目标 |
|------|------|------|
| 保证金收益率 | 收益/平均占用保证金 | >25% |
| 尾部损失 | 5%最差交易平均亏损 | <单笔2% |
| Greeks暴露效率 | 收益/Greeks暴露 | 正向 |
| 滑点占比 | 滑点成本/总收益 | <15% |

---

# 第4章 策略库

## 策略1: 波动率风险溢价(VRP)收割

### 策略逻辑
隐含波动率(IV)长期高于实现波动率(RV)，卖出期权可收割这个溢价。

### 信号构造
```python
VRP = IV_ATM - RV_20d
信号 = 1 if VRP > 阈值 else 0  # 阈值建议: VRP历史50%分位
```

### 头寸结构（风险定义版）
```
卖出ATM宽跨式 + 买入深度OTM保护
具体:
- 卖出 1张 ATM Call
- 卖出 1张 ATM Put
- 买入 1张 Delta=0.05 的OTM Call (保护)
- 买入 1张 Delta=-0.05 的OTM Put (保护)
最大亏损 = (ATM行权价 - OTM行权价) × 乘数 - 净权利金收入
```

### 风控规则
- 单笔最大亏损: 账户2%
- IV突破历史90%分位: 减仓50%
- 组合Delta绝对值>0.3: 对冲

### 执行方式
- 每周一开盘建仓
- 到期前5天移仓至下月
- 分批建仓(2-3次)

### 最可能失效原因
- 波动率长期飙升(如长期熊市)
- 尾部事件连续发生
- 流动性枯竭导致无法移仓

---

## 策略2: 期限结构套利

### 策略逻辑
近月与远月IV存在均值回归特性，当价差偏离时套利。

### 信号构造
```python
IV_Spread = IV_远月 - IV_近月
Z_Score = (IV_Spread - 均值) / 标准差
信号 = -1 if Z_Score > 2 else (1 if Z_Score < -2 else 0)
```

### 头寸结构
```
Z>2 (远月IV过高):
- 卖出 远月ATM Straddle
- 买入 近月ATM Straddle

Z<-2 (近月IV过高):
- 买入 远月ATM Straddle
- 卖出 近月ATM Straddle
```

### 风控规则
- Z-Score回归到±0.5时平仓
- 持有超过10天强制平仓
- 近月到期前3天必须平仓

### 执行方式
- 同时下单(尽量)
- 先做流动性好的腿

### 最可能失效原因
- 期限结构长期维持一个方向
- 近月到期带来的Gamma风险
- 两个月份流动性差异导致滑点不对称

---

## 策略3: 偏度/微笑交易

### 策略逻辑
波动率微笑的陡峭程度(Skew)有均值回归特性。

### 信号构造
```python
Skew = IV_25Delta_Put - IV_25Delta_Call
Z_Score = (Skew - 历史均值) / 历史标准差
```

### 头寸结构
```
Skew过陡(Z>2):
- 卖出 OTM Put
- 买入 OTM Call
(预期Skew变平)

Skew过平(Z<-2):
- 买入 OTM Put
- 卖出 OTM Call
```

### 风控规则
- Delta中性(通过期货对冲)
- 最大持有15天
- Skew回归50%目标平仓

### 最可能失效原因
- 市场结构性变化(如长期风险偏好转变)
- 下跌时Skew持续陡峭
- 对冲成本侵蚀利润

---

## 策略4: 波动率预测(买方)

### 策略逻辑
预测未来波动率>当前IV时买入，反之卖出。

### 信号构造
```python
RV_Forecast = GARCH/HAR模型预测
买入信号 = RV_Forecast > IV_ATM × 1.1
卖出信号 = RV_Forecast < IV_ATM × 0.9
```

### 头寸结构
```
买入信号: 买入ATM Straddle
卖出信号: 卖出ATM Straddle + 保护腿
```

### 风控规则
- 买方策略: 权利金亏损50%止损
- 卖方策略: 保证金占用超60%止损
- 持有到期前5天必须处理

### 最可能失效原因
- 波动率预测模型失效
- Theta损耗超过Vega收益
- 模型过拟合历史数据

---

## 策略5: 事件驱动

### 策略逻辑
重大事件(经济数据/政策)前波动率通常上升，事件后回落。

### 信号构造
```
事件日历: GDP/PMI/央行决议/成分股调整
事件前3-5天: 评估IV水平
IV < 历史事件前均值: 买入Straddle
IV > 历史事件前均值×1.3: 卖出(谨慎)
```

### 头寸结构
- 买入当周到期ATM Straddle
- 仓位: 账户1-2%权利金

### 风控规则
- 事件后立即评估，最多持有到事件后1天
- 权利金亏损50%止损

### 最可能失效原因
- **样本极小，过拟合风险极高**
- 事件被提前消化
- 事件后波动不及预期

---

## 策略6: Delta中性Gamma Scalping

### 策略逻辑
买入Gamma(Straddle)，通过Delta对冲锁定Gamma收益。

### 头寸结构
```
买入ATM Straddle
当Delta偏离>阈值时，用期货对冲回中性
```

### 信号构造
```python
Delta阈值 = ±0.2
当组合Delta > 0.2: 卖出期货对冲
当组合Delta < -0.2: 买入期货对冲
```

### 风控规则
- 对冲频率: 日内1-3次
- 权利金亏损30%止损
- 避开平今仓高成本时段

### 最可能失效原因
- 低波动率导致Gamma收益<Theta损耗
- 对冲成本(平今仓)侵蚀利润
- 跳空导致对冲失效

---

## 策略7: 备兑策略(Covered Call)

### 策略逻辑
持有期货多头+卖出虚值Call，增强收益。

### 头寸结构
```
买入 1手 IF期货
卖出 1张 Delta=0.3 的OTM Call
```

### 信号构造
- 震荡市/慢牛: 适合
- 快速上涨: 不适合(收益被限制)
- 下跌: 不适合(保护不足)

### 风控规则
- 期货止损: -5%
- Call端: 到期前移仓
- Delta监控: Call Delta>0.5时考虑移行权价

### 最可能失效原因
- 大涨行情错失收益
- 下跌时保护不足

---

## 策略8: 保护性Put(Protective Put)

### 策略逻辑
持有期货多头+买入Put对冲尾部风险。

### 头寸结构
```
买入 1手 IF期货
买入 1张 Delta=-0.2 的OTM Put
```

### 成本考量
- Put权利金是持续成本
- 适合预期有尾部风险但仍看多

### 风控规则
- Put到期自动失效
- 需持续滚动买入

### 最可能失效原因
- 长期买入Put成本过高
- 保护范围不足

---

## 策略难度与适用性汇总

| 策略 | 执行难度 | 资金要求 | 散户适合度 | 机构适合度 |
|------|----------|----------|------------|------------|
| VRP+保护 | 高 | 高 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| 期限结构 | 中 | 中 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| Skew交易 | 高 | 中 | ⭐⭐ | ⭐⭐⭐⭐ |
| 波动率预测 | 高 | 中 | ⭐⭐ | ⭐⭐⭐⭐ |
| 事件驱动 | 低 | 低 | ⭐⭐⭐ | ⭐⭐⭐ |
| Gamma Scalping | 很高 | 高 | ⭐ | ⭐⭐⭐⭐ |
| 备兑 | 低 | 高 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 保护性Put | 低 | 中 | ⭐⭐⭐⭐ | ⭐⭐⭐ |

---

# 第5章 风控体系（机构级）

## 5.1 组合层风控

### Greeks限额

| Greek | 限额 | 说明 |
|-------|------|------|
| Net Delta | 账户净值×10% | 方向暴露 |
| Net Gamma | 待定(基于压力测试) | ±3%指数变动的P&L |
| Net Vega | 账户净值×5% | IV变动10%的P&L |
| Net Theta | 监控但不限制 | 时间损耗 |

### 保证金与流动性

| 指标 | 限额 | 触发动作 |
|------|------|----------|
| 保证金使用率 | <60% | 超过减仓 |
| 可用资金 | >总资产20% | 低于补充 |
| 单品种集中度 | <30% | 超过分散 |

### 情景压力测试

| 情景 | 假设 | 触发条件 |
|------|------|----------|
| 指数跳空-5% | Delta+Gamma损失 | 压力P&L>账户10% |
| IV飙升50% | Vega损失(卖方) | 压力P&L>账户10% |
| 流动性枯竭 | 价差扩大5倍 | 无法平仓测试 |
| 多重叠加 | 以上同时发生 | 最坏情况评估 |

## 5.2 策略层风控

| 规则 | 参数 | 动作 |
|------|------|------|
| 单笔最大亏损 | 账户2% | 强制平仓 |
| 日内止损 | 账户3% | 当日停止交易 |
| 连续亏损熔断 | 5笔连亏 | 暂停策略1周 |
| 月度止损 | 账户8% | 暂停策略1月 |
| 模型漂移 | 样本外偏离>50% | 重训/停用 |

## 5.3 运营层风控

| 风险 | 检测 | 应对 |
|------|------|------|
| 交易异常 | 成交价偏离>X% | 人工复核 |
| 数据延迟 | 延迟>Y秒 | 暂停自动交易 |
| 系统断线 | 心跳检测 | 短信告警+人工接管 |
| 极端行情 | 涨跌停/波动率飙升 | 预设减仓指令 |

## 5.4 交付物

| 文档 | 内容 |
|------|------|
| 风控参数表 | 全部限额、阈值、计算公式 |
| 压力测试模板 | 各情景测试代码与报告模板 |
| 熔断SOP | 各级熔断的操作流程、权限、时效 |
| 日度风控报告 | 每日Greeks暴露、保证金、压力测试结果 |

---

# 第6章 交易执行与系统架构

## 6.1 系统架构图

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  数据层     │───→│  研究层     │───→│  策略层     │
│ (行情/历史) │    │ (回测/分析) │    │ (信号生成)  │
└─────────────┘    └─────────────┘    └─────────────┘
                                            │
                                            ↓
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  监控层     │←───│  风控层     │←───│  执行层     │
│ (Dashboard) │    │ (实时风控)  │    │ (订单管理)  │
└─────────────┘    └─────────────┘    └─────────────┘
```

## 6.2 关键模块

### 研究环境
- Python + Jupyter
- 历史数据库接口
- 回测引擎

### 回测引擎要求
- 支持多腿期权组合
- 支持保证金计算
- 支持到期处理
- 支持Greeks计算
- 交易成本可配置

### 仿真撮合
- 模拟真实盘口
- 支持滑点模型
- 支持部分成交

### 实盘交易
- 券商/期货公司API对接
- 订单状态管理
- 成交回报处理
- 撤单与重试逻辑

### 监控告警
- 实时P&L
- Greeks暴露
- 风控指标
- 异常告警(短信/微信)

## 6.3 多腿下单逻辑

```python
def execute_spread(legs, urgency='normal'):
    """
    多腿价差执行
    legs: [(side, contract, qty), ...]
    urgency: 'normal'(挂单等待) / 'urgent'(吃单)
    """
    if urgency == 'normal':
        # 先做流动性差的腿
        legs_sorted = sort_by_liquidity(legs, ascending=True)
        for leg in legs_sorted:
            place_limit_order(leg, timeout=30)
    else:
        # 市价吃单
        for leg in legs:
            place_market_order(leg)
```

## 6.4 滑点模型

```python
def estimate_slippage(contract, size, side):
    """
    滑点估计
    """
    spread = get_bid_ask_spread(contract)
    depth = get_depth(contract)

    # 基础滑点 = 价差的一半
    base_slip = spread / 2

    # 冲击滑点 = 根据深度和数量估计
    impact_slip = estimate_impact(size, depth)

    return base_slip + impact_slip
```

## 6.5 交付物

| 交付物 | 说明 |
|--------|------|
| 系统模块图 | 各模块关系与数据流 |
| 接口清单 | 数据接口、交易接口、监控接口 |
| 延迟指标 | 数据延迟<Xms，下单延迟<Yms |
| 稳定性指标 | 可用率>99.9% |
| 成交质量报告 | 滑点统计、成交率统计 |

---

# 第7章 项目计划与团队预算

## 7.1 阶段规划

### Phase 1: 可研究 (M1-M2)

**目标**: 数据+回测闭环

| 任务 | 周期 | 交付物 |
|------|------|--------|
| 数据源选型与采购 | W1-W2 | 数据合同 |
| 数据ETL开发 | W2-W4 | ETL代码+数据字典 |
| 回测引擎搭建 | W3-W6 | 回测框架 |
| 核心策略初步回测 | W5-W8 | 回测报告 |

**人员**: 量化研究员1人 + 开发1人
**预算**: 数据5万 + 人力10万 = 15万
**验收标准**: 能完整回测2年期权数据
**Go条件**: 至少2个策略Calmar>0.8

### Phase 2: 可仿真 (M3-M4)

**目标**: 仿真撮合+风控系统

| 任务 | 周期 | 交付物 |
|------|------|--------|
| 仿真撮合开发 | W1-W3 | 仿真系统 |
| 风控模块开发 | W2-W4 | 风控系统 |
| 策略精调 | W3-W6 | 优化后策略 |
| Paper Trading | W5-W8 | 仿真报告 |

**人员**: 量化研究员1人 + 开发1人 + 风控0.5人
**预算**: 人力15万 + 系统5万 = 20万
**验收标准**: 仿真运行4周无重大Bug
**Go条件**: 仿真Calmar>0.6，最大回撤<15%

### Phase 3: 小资金实盘 (M5-M6)

**目标**: 小仓位验证

| 任务 | 周期 | 交付物 |
|------|------|--------|
| 交易接口对接 | W1-W2 | 交易系统 |
| 小资金上线 | W3 | 10%仓位运行 |
| 监控与调优 | W3-W8 | 运行报告 |

**人员**: 全团队
**预算**: 人力15万 + 运营5万 = 20万
**验收标准**: 实盘运行8周，无风控事件
**Go条件**: 实盘结果与仿真偏离<30%

### Phase 4: 扩容 (M7+)

**目标**: 策略扩容+组合优化

| 任务 | 交付物 |
|------|--------|
| 容量评估 | 各策略容量报告 |
| 仓位提升 | 逐步提升至目标仓位 |
| 新策略开发 | 策略库扩展 |
| 组合优化 | 策略组合权重优化 |

## 7.2 团队配置

| 角色 | 人数 | 职责 | 薪资范围(年) |
|------|------|------|--------------|
| 量化研究员 | 1-2 | 策略研发、回测 | 30-60万 |
| 开发工程师 | 1-2 | 系统开发 | 30-50万 |
| 交易/风控 | 1 | 执行、监控 | 25-40万 |

**最小团队**: 3人
**推荐团队**: 4-5人

## 7.3 预算汇总

| 项目 | Phase 1 | Phase 2 | Phase 3 | 年度合计 |
|------|---------|---------|---------|----------|
| 人力 | 10万 | 15万 | 15万 | 40万 |
| 数据 | 5万 | - | - | 5万 |
| 系统 | - | 5万 | 5万 | 10万 |
| 运营 | - | - | 5万 | 5万 |
| **合计** | **15万** | **20万** | **25万** | **60万** |

**交易本金**: 另需100-500万

---

# 第8章 反证清单（不少于10条）

## 必须停止/降仓/重训的条件

| # | 反证条件 | 触发动作 |
|---|----------|----------|
| 1 | **连续5笔亏损** | 暂停策略1周，复盘原因 |
| 2 | **月度亏损>8%** | 暂停策略1个月 |
| 3 | **IV持续>历史90%分位超过10天** | 卖方策略降仓50% |
| 4 | **策略样本外Calmar下降>50%** | 停止策略，重新研究 |
| 5 | **单日滑点成本>预期2倍** | 检查执行逻辑，可能降仓 |
| 6 | **流动性指标恶化(价差扩大>3倍持续3天)** | 暂停交易该品种 |
| 7 | **监管政策重大变化(如限仓收紧)** | 立即评估影响，可能暂停 |
| 8 | **数据源连续3天异常** | 切换数据源或暂停 |
| 9 | **期现价差持续异常(>历史3σ超5天)** | 检查定价模型 |
| 10 | **Greeks对冲失效(实际P&L vs预期偏离>50%)** | 检查Greeks计算 |
| 11 | **极端行情触发(单日涨跌停)** | 按预案减仓 |
| 12 | **系统故障导致无法下单>30分钟** | 人工接管+事后复盘 |

---

# 第9章 散户实战方案

## 9.1 品种选择

### 推荐品种（优先级排序）

| 排序 | 品种 | 代码 | 理由 |
|------|------|------|------|
| 1 | **沪深300股指期权** | IO | 流动性最好，价差最小 |
| 2 | **中证1000股指期权** | MO | 波动率高，机会多 |
| 3 | **沪深300股指期货** | IF | 配合期权做组合 |

### 不推荐品种

| 品种 | 原因 |
|------|------|
| HO(上证50期权) | 流动性相对较差 |
| 深度虚值期权 | 流动性极差，价差大 |
| 远月合约 | 流动性差，移仓成本高 |

## 9.2 只推荐"风险定义"结构

### 为什么必须是风险定义结构？

| 结构类型 | 最大亏损 | 散户适合度 | 原因 |
|----------|----------|------------|------|
| 裸买Call/Put | 有限(权利金) | ⭐⭐⭐ | 风险有限但Theta损耗大 |
| 裸卖Call/Put | **无限** | ❌ | 绝对禁止 |
| 牛市价差(Bull Spread) | **有限** | ⭐⭐⭐⭐ | 推荐 |
| 熊市价差(Bear Spread) | **有限** | ⭐⭐⭐⭐ | 推荐 |
| 铁鹰(Iron Condor) | **有限** | ⭐⭐⭐⭐ | 推荐 |
| 买入跨式(Long Straddle) | **有限** | ⭐⭐⭐ | 事件驱动可用 |

### 推荐结构详解

#### 结构A: 牛市看涨价差 (Bull Call Spread)

```
看多时使用:
- 买入 1张 ATM Call (行权价K1)
- 卖出 1张 OTM Call (行权价K2, K2>K1)

最大盈利 = (K2-K1)×100 - 净权利金支出
最大亏损 = 净权利金支出
盈亏平衡 = K1 + 净权利金/100
```

#### 结构B: 熊市看跌价差 (Bear Put Spread)

```
看空时使用:
- 买入 1张 ATM Put (行权价K1)
- 卖出 1张 OTM Put (行权价K2, K2<K1)

最大盈利 = (K1-K2)×100 - 净权利金支出
最大亏损 = 净权利金支出
```

#### 结构C: 铁鹰 (Iron Condor)

```
震荡市使用:
- 卖出 1张 OTM Call (行权价K3)
- 买入 1张 更OTM Call (行权价K4, K4>K3) 【保护】
- 卖出 1张 OTM Put (行权价K2)
- 买入 1张 更OTM Put (行权价K1, K1<K2) 【保护】

最大盈利 = 净权利金收入
最大亏损 = (K3-K4)×100 - 净权利金 或 (K2-K1)×100 - 净权利金
```

## 9.3 交易规则模板（可勾选）

### 入场信号（三选一）

#### 方案A: 趋势信号型
```
□ 标的指数收盘价 > MA20 且 MA20 > MA60
  → 开仓: Bull Call Spread
□ 标的指数收盘价 < MA20 且 MA20 < MA60
  → 开仓: Bear Put Spread
```

#### 方案B: 波动率分位型
```
□ IV_ATM < 历史20%分位
  → 开仓: Long Straddle (买波动)
□ IV_ATM > 历史80%分位 且 有保护腿
  → 开仓: Iron Condor (卖波动)
```

#### 方案C: 期限结构型
```
□ 远月IV - 近月IV > 历史均值 + 2倍标准差
  → 开仓: 卖远月Straddle + 买近月Straddle
```

### 建仓方式
```
□ 分批建仓: 计划仓位分2-3次进入
□ 避开时段: 开盘15分钟、收盘15分钟、午盘开盘
□ 挂单逻辑: 先做流动性差的腿，用限价单
□ 滑点预算: 每腿预留0.5-1点滑点
```

### 加仓规则
```
□ 盈利加仓: 浮盈>初始权利金50%时，可加仓50%
□ 亏损不加仓: 浮亏时禁止加仓
□ 单品种上限: 总仓位不超过账户30%
```

### 减仓规则
```
□ 信号反转: 入场信号消失，减仓50%
□ 时间衰减: 剩余到期<5天，必须处理
□ 波动率变化: IV变化>20%，评估是否减仓
```

### 止损规则（三选一或组合）
```
□ 最大亏损止损: 该笔交易亏损达到账户X%时平仓
  建议: 保守2%, 中性3%, 激进5%

□ 结构价值止损: 价差/组合价值下降Y%时平仓
  建议: 50%

□ 标的破位止损: 标的价格突破关键支撑/阻力时平仓
  (适用于方向性策略)
```

### 止盈规则
```
□ 分批止盈:
  - 盈利达50%目标: 平仓1/3
  - 盈利达80%目标: 再平仓1/3
  - 剩余持有到到期或信号消失

□ 时间止盈: 剩余天数<5天 且 盈利，平仓

□ IV止盈(卖方): IV下降到入场时的70%，平仓
```

### 到期管理
```
□ 到期前5天: 评估是否移仓到下月
□ 到期前2天: 必须处理所有持仓
  - 深度实值: 平仓(避免行权操作)
  - 深度虚值: 可让其到期作废
  - 平值附近: 必须平仓(Pin风险)
□ 禁止: 持有到最后交易日收盘
```

## 9.4 仓位与风险预算公式

### 核心公式

```
单笔风险 = 账户权益 × r%
最大可能亏损 = 头寸数量 × 单位最大亏损
头寸数量 = 单笔风险 / 单位最大亏损

总风险 = Σ(各仓位最大可能亏损) ≤ 账户权益 × R%
```

### 参数建议

| 风格 | 单笔风险(r) | 总风险(R) | 适用人群 |
|------|-------------|-----------|----------|
| 保守 | 1% | 5% | 新手/风险厌恶 |
| 中性 | 2% | 10% | 有经验/中等风险 |
| 激进 | 3% | 15% | 专业/高风险承受 |

### 示例计算

```
账户: 50万
风格: 中性(r=2%, R=10%)

单笔风险 = 50万 × 2% = 1万
总风险上限 = 50万 × 10% = 5万

若开Bull Call Spread:
  买入IO 4000 Call @ 80点 (8000元)
  卖出IO 4100 Call @ 40点 (4000元)
  净支出 = 4000元 = 最大亏损

可开手数 = 1万 / 4000 = 2.5 → 取2手
```

## 9.5 复盘模板（每周一次）

### 周度复盘表

```
日期: ____年__月__日 (第__周)
账户净值: _______ 周收益率: ______%

【本周交易汇总】
| 日期 | 品种 | 方向 | 开仓价 | 平仓价 | P&L | 备注 |
|------|------|------|--------|--------|-----|------|
|      |      |      |        |        |     |      |

【Greeks归因分析】
本周盈亏主要来自:
□ Delta (方向): ____元 (__%)
□ Gamma (波动): ____元 (__%)
□ Theta (时间): ____元 (__%)
□ Vega (波动率): ____元 (__%)
□ 交易成本: ____元 (__%)

是否符合预期? □是 □否
若否，原因:_____________

【执行质量分析】
平均滑点: ____点
滑点是否异常? □正常 □偏高
原因:_____________

【反证条件检查】
□ 连续亏损笔数: __笔 (阈值5笔)
□ 月度累计亏损: __% (阈值8%)
□ IV分位数: __% (关注>80%)
□ 流动性状况: □正常 □恶化

是否触发任何反证条件? □否 □是→动作:______

【下周计划】
继续持有: _______________
计划开仓: _______________
风险关注: _______________
```

## 9.6 散户禁止事项（至少5条）

### 绝对禁止

| # | 禁止行为 | 原因 | 后果 |
|---|----------|------|------|
| 1 | **裸卖期权** | 风险无限 | 可能爆仓归零 |
| 2 | **满仓操作** | 无容错空间 | 一次错误致命 |
| 3 | **不设止损** | 亏损无限扩大 | 账户毁灭 |
| 4 | **持有到期日收盘** | Pin风险+行权风险 | 意外损失 |
| 5 | **追加保证金后继续扛单** | 沉没成本谬误 | 加速爆仓 |

### 强烈不建议

| # | 行为 | 原因 |
|---|------|------|
| 6 | 深度虚值期权(Delta<0.1) | 流动性极差，价差大 |
| 7 | 远月合约(>3个月) | 流动性差，Theta不明显 |
| 8 | 频繁日内交易 | 成本高(平今仓) |
| 9 | 杠杆过高(保证金使用>70%) | 无缓冲空间 |
| 10 | 基于消息/小道消息交易 | 信息不对称，容易被收割 |

---

# 附录

## 附录A: 待验证清单

| 项目 | 优先级 | 验证方式 |
|------|--------|----------|
| 最新保证金比例调整 | P0 | 查中金所公告 |
| 期权保证金计算公式 | P0 | 查交易所规则文件 |
| 做市商报价义务细节 | P1 | 查做市商协议 |
| 大户报告阈值 | P1 | 查交易所规则 |
| 历史极端行情IV数据 | P1 | 数据源验证 |
| 各品种实际bid-ask价差 | P2 | 实盘观察 |

## 附录B: 接下来最该做的10个动作

| 优先级 | 动作 | 时间 | 产出 |
|--------|------|------|------|
| 1 | 开通中金所期权仿真账户 | 1天 | 仿真账户 |
| 2 | 获取期权历史数据(聚宽/AKShare) | 3天 | 数据集 |
| 3 | 搭建期权定价+Greeks计算模块 | 1周 | Python代码 |
| 4 | 回测VRP策略(带保护腿) | 2周 | 回测报告 |
| 5 | 回测期限结构套利策略 | 2周 | 回测报告 |
| 6 | 设计风控参数表 | 1周 | 风控文档 |
| 7 | 小资金(5万)实盘验证 | 4周 | 实盘记录 |
| 8 | 建立每周复盘机制 | 持续 | 复盘记录 |
| 9 | 学习Greeks深度理解 | 持续 | 知识积累 |
| 10 | 关注中金所规则变化 | 持续 | 规则跟踪 |

---

## 数据来源

1. [中国金融期货交易所官网](http://www.cffex.com.cn/)
2. [中金所交易规则](http://www.cffex.com.cn/jysgz/)
3. [中金所套期保值管理办法](http://www.cffex.com.cn/tqbzytledbl/)
4. [新浪财经-股指期货](http://finance.sina.com.cn/futuremarket/)
5. [知乎-期货期权专栏](https://www.zhihu.com/)

---

**免责声明**:
本报告仅供研究参考，不构成投资建议。期货期权交易具有高风险，可能导致本金全部损失。过往表现不代表未来收益。投资者应根据自身风险承受能力谨慎决策。

---

*报告版本: v1.0*
*编制日期: 2025-01-05*
